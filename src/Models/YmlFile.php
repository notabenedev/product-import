<?php

namespace Notabenedev\ProductImport\Models;

use App\Category;
use App\ImportYml;
use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;
use Illuminate\Support\Facades\Storage;


class YmlFile extends Model
{
    use  HasFactory;

    protected $fillable = [
        "import_yml_id",
        "path",
        "type",
        "original_name"
    ];

    protected static function boot()
    {
        parent::boot();

    }

    /**
     *
     * Триггеры на удаление файлов
     */
    protected static function booting()
    {
        parent::booting(); // TODO: Change the autogenerated stub
        self::deleting(function(self $model){
            Storage::disk("public")->delete($model->path);
        });
    }

    /**
     * Выгрузка
     *
     * @return \Illuminate\Database\Eloquent\Relations\BelongsTo
     */
    public function yml()
    {
        return $this->belongsTo(ImportYml::class);
    }

    /**
     * Categories imported by file
     *
     * @return \Illuminate\Database\Eloquent\Relations\HasMany
     */
    public function categories()
    {
        return $this->hasMany(Category::class);
    }

    /**
     * Изменить дату создания.
     *
     * @param $value
     * @return string
     */
    public function getCreatedAtAttribute($value)
    {
        return datehelper()->changeTz($value);
    }

    /**
     * Изменить дату запуска.
     *
     * @param $value
     * @return string
     */
    public function getStartedAtAttribute($value)
    {
        return datehelper()->changeTz($value);
    }
}
